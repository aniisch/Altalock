<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.socket.io; connect-src 'self' http://localhost:5000 ws://localhost:5000 https://cdn.socket.io; img-src 'self' data: file: http://localhost:5000; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">
    <title>AltaLock - Sécurité Faciale</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <svg viewBox="0 0 24 24" width="28" height="28" class="logo-icon">
                        <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                    </svg>
                    <span>AltaLock</span>
                </div>
                <span id="connectionStatus" class="connection-status">Connexion...</span>
            </div>

            <nav class="main-nav">
                <a href="#" class="active" data-page="dashboard">Dashboard</a>
                <a href="#" data-page="users">Utilisateurs</a>
                <a href="#" data-page="settings">Paramètres</a>
                <a href="#" data-page="history">Historique</a>
            </nav>

            <div class="header-right">
                <button id="toggleDetectionBtn" class="btn btn-primary">
                    Démarrer la surveillance
                </button>
                <div class="window-controls">
                    <button id="minimizeBtn" class="window-btn" title="Réduire">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 13H5v-2h14v2z"/></svg>
                    </button>
                    <button id="maximizeBtn" class="window-btn" title="Agrandir">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                    </button>
                    <button id="closeBtn" class="window-btn close" title="Fermer">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- PAGE: Dashboard -->
            <div id="page-dashboard" class="page active">
                <div class="dashboard-grid">
                    <!-- Video Feed -->
                    <section class="video-feed card">
                        <div class="card-header">
                            <h2>Flux Vidéo en Direct</h2>
                            <div id="detectionOverlay" class="detection-info"></div>
                        </div>
                        <div class="video-container" id="videoContainer">
                            <div class="video-placeholder">
                                <svg viewBox="0 0 24 24" width="64" height="64">
                                    <path fill="currentColor" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4zM14 13h-3v3H9v-3H6v-2h3V8h2v3h3v2z"/>
                                </svg>
                                <p>Cliquez sur "Démarrer la surveillance" pour activer la caméra</p>
                            </div>
                        </div>
                    </section>

                    <!-- Users Panel (mini) -->
                    <section class="users-panel card">
                        <div class="card-header">
                            <h2>Utilisateurs Autorisés</h2>
                            <button id="addUserBtn" class="btn btn-small btn-secondary">
                                + Ajouter
                            </button>
                        </div>
                        <div class="users-grid" id="usersGrid">
                            <div class="loading">Chargement...</div>
                        </div>
                    </section>

                    <!-- Status Panel -->
                    <section class="status-panel card">
                        <div class="card-header">
                            <h2>État du Système</h2>
                        </div>
                        <div class="status-items">
                            <div class="status-item">
                                <span class="status-label">État</span>
                                <span class="status-value inactive">En veille</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Caméra</span>
                                <span class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Visages enregistrés</span>
                                <span class="status-value">0</span>
                            </div>
                        </div>
                    </section>

                    <!-- Activity Log -->
                    <section class="activity-log card">
                        <div class="card-header">
                            <h2>Journal d'Activité</h2>
                        </div>
                        <div class="log-container" id="logContainer">
                            <p class="empty-state">Aucune activité récente</p>
                        </div>
                    </section>
                </div>
            </div>

            <!-- PAGE: Utilisateurs -->
            <div id="page-users" class="page">
                <div class="page-header">
                    <h1>Gestion des Utilisateurs</h1>
                    <div class="header-actions">
                        <button id="addUserBtnPage" class="btn btn-primary">+ Ajouter autorisé</button>
                        <button id="addBlacklistBtn" class="btn btn-danger">+ Ajouter blacklist</button>
                    </div>
                </div>

                <h3 class="section-title">Utilisateurs Autorisés</h3>
                <div class="users-full-grid" id="usersFullGrid">
                    <div class="loading">Chargement...</div>
                </div>

                <h3 class="section-title" style="margin-top: 30px; color: var(--danger);">Personnes Blacklistées</h3>
                <div class="users-full-grid" id="blacklistGrid">
                    <p class="empty-state">Aucune personne blacklistée</p>
                </div>
            </div>

            <!-- PAGE: Paramètres -->
            <div id="page-settings" class="page">
                <div class="page-header">
                    <h1>Paramètres</h1>
                </div>
                <div class="settings-container">
                    <section class="settings-section card">
                        <h3>Sécurité</h3>
                        <div class="setting-item">
                            <label>Délai avant verrouillage</label>
                            <div class="setting-control">
                                <input type="range" id="unknownThresholdSeconds" min="1" max="5" step="1" value="3">
                                <span id="unknownThresholdValue">3</span> seconde(s)
                            </div>
                            <p class="setting-desc">Temps de détection d'un visage inconnu avant verrouillage automatique</p>
                        </div>
                        <div class="setting-item">
                            <label>Verrouiller l'écran</label>
                            <div class="setting-control">
                                <input type="checkbox" id="lockScreenEnabled" checked>
                                <span>Activer le verrouillage automatique</span>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label>Mise en veille après verrouillage</label>
                            <div class="setting-control">
                                <input type="checkbox" id="sleepAfterLock" checked>
                                <span>Arrêter la surveillance après verrouillage</span>
                            </div>
                        </div>
                    </section>
                    <section class="settings-section card">
                        <h3>Alertes</h3>
                        <div class="setting-item">
                            <label>Notification sonore</label>
                            <div class="setting-control">
                                <input type="checkbox" id="soundAlert" checked>
                                <span>Activer les alertes vocales</span>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label>Message d'alerte par défaut</label>
                            <div class="setting-control">
                                <input type="text" id="alertMessage" placeholder="Accès non autorisé détecté" style="min-width: 300px;">
                            </div>
                            <p class="setting-desc">Message prononcé pour les inconnus (les blacklistés ont leur propre message)</p>
                        </div>
                        <div class="setting-item">
                            <label>Email d'alerte</label>
                            <div class="setting-control">
                                <input type="email" id="alertEmail" placeholder="votre@email.com">
                            </div>
                            <p class="setting-desc">Recevez une notification par email avec la photo de l'intrus</p>
                        </div>
                    </section>
                    <section class="settings-section card">
                        <h3>Caméra</h3>
                        <div class="setting-item">
                            <label>Source vidéo</label>
                            <div class="setting-control">
                                <select id="cameraSource">
                                    <option value="0">Caméra par défaut (0)</option>
                                    <option value="1">Caméra 1</option>
                                    <option value="2">Caméra 2</option>
                                </select>
                            </div>
                        </div>
                    </section>
                    <div class="settings-actions">
                        <button id="saveSettingsBtn" class="btn btn-primary">Sauvegarder</button>
                        <button id="importLegacyBtn" class="btn btn-secondary">Importer anciens visages</button>
                    </div>
                </div>
            </div>

            <!-- PAGE: Historique -->
            <div id="page-history" class="page">
                <div class="page-header">
                    <h1>Historique des Événements</h1>
                    <button id="clearHistoryBtn" class="btn btn-secondary">Effacer l'historique</button>
                </div>
                <div class="history-container">
                    <div class="history-filters">
                        <select id="historyFilter">
                            <option value="all">Tous les événements</option>
                            <option value="intrusion">Intrusions</option>
                            <option value="detection">Détections</option>
                        </select>
                    </div>
                    <div class="history-list" id="historyList">
                        <p class="empty-state">Aucun événement enregistré</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <span>AltaLock v2.0</span>
            <span>Protection par reconnaissance faciale</span>
        </footer>
    </div>

    <!-- Notifications Container -->
    <div id="notifications" class="notifications-container"></div>

    <script src="renderer.js"></script>
</body>
</html>
